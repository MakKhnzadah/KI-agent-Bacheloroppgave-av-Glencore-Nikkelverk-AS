@startuml
' KI-agent + process knowledge base (MVP) â€” Simplified class diagram

skinparam style strictuml
skinparam packageStyle rectangle
skinparam shadowing false
skinparam classAttributeIconSize 0

hide circle
hide empty members

class Settings

' Roles / people (from use-case diagram)
class UserAccount
class Employee
class ExpertUser
enum Role

Employee -|> UserAccount
ExpertUser -|> UserAccount
UserAccount ..> Role

class Suggestion
class ReviewedSuggestion
enum ReviewDecision

' Login/auth (not implemented in MVP CLI, but in use-cases)
class AuthService
class Session
AuthService ..> UserAccount : authenticates
AuthService ..> Session : creates

class IngestService
class Normalizer
class SuggestionGenerator
class ReviewService
class ApplyService
class HtmlBuilder

class KnowledgeBaseIndexer
interface VectorStore
class ChromaVectorStore
class EmbeddingsClient

class "Document Sources" as DocSources <<external>>
class "Repo/Storage\n(Azure/Git)" as Repo <<external>>
class "LLM Embeddings API\n(Microsoft/OpenAI)" as LLM <<external>>
class "Vector DB\n(Chroma)" as VectorDB <<external>>

' Pipeline (use-case flow)
IngestService ..> Settings
Normalizer ..> Settings
SuggestionGenerator ..> Settings
ReviewService ..> Settings
ApplyService ..> Settings
HtmlBuilder ..> Settings

' Who uses what
Employee ..> HtmlBuilder : read knowledge (HTML)
ExpertUser ..> IngestService : upload documents
ExpertUser ..> ReviewService : review/approve/reject
ExpertUser ..> ApplyService : save updates
UserAccount ..> AuthService : login

IngestService ..> DocSources : reads
SuggestionGenerator ..> Suggestion : creates
ReviewService ..> Suggestion : reads
ReviewService ..> ReviewedSuggestion : writes
ReviewedSuggestion o-- Suggestion
ReviewedSuggestion ..> ReviewDecision
ApplyService ..> ReviewedSuggestion : reads

ApplyService ..> Repo : writes Markdown
HtmlBuilder ..> Repo : writes HTML

' Optional: semantic search
KnowledgeBaseIndexer ..> Settings
KnowledgeBaseIndexer ..> EmbeddingsClient
KnowledgeBaseIndexer ..> VectorStore
VectorStore <|.. ChromaVectorStore
ChromaVectorStore ..> VectorDB
EmbeddingsClient ..> LLM

note right of SuggestionGenerator
  MVP: heuristic suggestions.
  Future: LLM-generated.
end note

note right of IngestService
  MVP: .txt/.md only.
end note

note bottom of AuthService
  Conceptual (use-cases): login + roles.
  Current MVP CLI has no auth/user database.
end note

@enduml
